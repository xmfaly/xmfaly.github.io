---
title: 换个主题换个心情
cover: /img/cover/cover-8
date: 2018-09-16 00:17:26
tags:
---
<!--最近发生了很多的事情，人都会变，去年的这个时候也发生了很多事情，也就从那个时候开始觉得人还是把能掌握的东西牢牢地抓住比较好，一定要拥有自己的实力，不要受制于人。不过也算蛮幸运的，去年已经受到过那么大的打击，今年处理类似的事情也就游刃有余了。-->
今天本来约了小伙伴出散心的，但她早上给我发消息说突然要去面试，于是就剩我自己一个人，趁着没事将博客的主题换了一下。  
其实最初想自己写一个的，但一直没什么思路，四处乱逛的时候偶然间发现了[diaspora](https://github.com/Fechin/hexo-theme-diaspora)这个主题，并且一见钟情，这个主题是从WordPress上面移植过来的，原作者是[@Loeify](https://github.com/LoeiFy/Diaspora)  
整个主题的风格是极简主义的，一个列表页，一个文章页，当我看到他的列表页的时候就已经被征服了。  
列表页的每个列表又两部分组成，一个是文章标题简介，另一个是一张封面图片，不是什么不常见的设计，但是在这个主题的排版之下就显得特别的大气。  
虽然样式我比较满意，但是功能方面还有一些细节方面我觉得还是要自己改改的。

### 没用的功能
- 首先我觉得他的音乐播放功能比较鸡肋，直接去掉。  
- 二维码分享也是，直接发网址不就行了，发啥二维码呀，直接去掉。   
### 改的部分
- 主题里面集成了[gittalk](https://github.com/gitalk/gitalk)做评论功能，对着他的文档配置了几次，就是搞不定，然后去看了`gittalk`文档发现有个id字段必须传50以下的字符，他代码的鲁棒性不是很好，我就顺手改了一下。
    ```
     id: location.pathname.substr(0,49)
    ```
- css样式里面有写的不严谨的问题，压缩的时候会出问题，改了一下。
### 添加的部分
- 图片代码压缩  
    采用`gulp`来做这个功能
    ```js
    var gulp = require('gulp');
    var minifycss = require('gulp-clean-css');
    var uglify = require('gulp-uglify');
    var htmlmin = require('gulp-htmlmin');
    var htmlclean = require('gulp-htmlclean');
    var imagemin = require('gulp-imagemin');
    var del = require('del');
    var runSequence = require('run-sequence');
    var Hexo = require('hexo');
    // 清除public文件夹
    gulp.task('clean', function () {
        return del(['public/**/*']);
    });
    // generate html with 'hexo generate'
    var hexo = new Hexo(process.cwd(), {});
    gulp.task('generate', function (cb) {
        hexo.init().then(function () {
            return hexo.call('generate', {
                watch: false
            });
        }).then(function () {
            return hexo.exit();
        }).then(function () {
            return cb()
        }).catch(function (err) {
            console.log(err);
            hexo.exit(err);
            return cb(err);
        })
    })
    // 压缩public目录下的所有css
    gulp.task('minify-css', function () {
        return gulp.src('./public/**/*.css')
            .pipe(minifycss({
                compatibility: 'ie8'
            }))
            .pipe(gulp.dest('./public'));
    });
    // 压缩public目录下的所有html
    gulp.task('minify-html', function () {
        return gulp.src('./public/**/*.html')
            .pipe(htmlclean())
            .pipe(htmlmin({
                removeComments: true,
                minifyJS: true,
                minifyCSS: true,
                minifyURLs: true,
            }))
            .pipe(gulp.dest('./public'))
    });
    // 压缩public目录下的所有js
    gulp.task('minify-js', function () {
        return gulp.src('./public/**/*.js')
            .pipe(uglify())
            .pipe(gulp.dest('./public'));
    });
    // 压缩public目录下的所有img： 这个采用默认配置
    gulp.task('minify-img', function () {
        return gulp.src('./public/img/**/*.*')
            .pipe(imagemin())
            .pipe(gulp.dest('./public/img'))
    })
    // 同上，压缩图片，这里采用了： 最大化压缩效果。
    gulp.task('minify-img-aggressive', function () {
        return gulp.src('./public/img/**/*.*')
            .pipe(imagemin(
                [imagemin.gifsicle({ 'optimizationLevel': 3 }),
                imagemin.jpegtran({ 'progressive': true }),
                imagemin.optipng({ 'optimizationLevel': 7 }),
                imagemin.svgo()],
                { 'verbose': true }))
            .pipe(gulp.dest('./public/img'))
    })
    // 用run-sequence并发执行，同时处理html，css，js，img
    gulp.task('compress', function (cb) {
        runSequence(['minify-html', 'minify-css', 'minify-js', 'minify-img-aggressive'], cb);
    });
    // 执行顺序： 清除public目录 -> 产生原始博客内容 -> 执行压缩混淆
    gulp.task('build', function (cb) {
        runSequence('clean', 'generate', 'compress', cb)
    });
    gulp.task('default', ['build'])
    ```
- 封面图床自动重命名,后来加的图片还会填补空位
     ```
    const fs = require('fs');
    let baseDir = 'source/img/cover/'
    let indexArr = [];
    
    fs.readdir(baseDir, (err, files) => {
    
        // 已经命名过的数量
        let hasNameNum = 0;
        // 找到目前最大的index
        files.forEach((file) => {
    
            // 以前已经命名过的
            let covered = file.match(/cover-\d+/);
            if (covered) {
                indexArr.push(Number(covered[0].match(/\d+/)[0]));
                ++hasNameNum;
            }
        })
    
        // 如果存在没有命名的
        if (hasNameNum !== files.length) {
            indexArr.sort((a, b) => ( a - b ));
            let index = 0;
    
            let k = 0; // 已经命名数组的下标
            while (files.length > hasNameNum) {
                files.forEach((file) => {
                    if (!file.startsWith('cover') && !file.endsWith('.js')) {
                        index++;
                        if (indexArr[k] && index < indexArr[k]) {
                            console.log(index);
                            fs.rename(baseDir + file, `${baseDir}cover-${index}`, () => { });
                            hasNameNum++;
                        } else if (indexArr[k]) {
                            k++;
                        } else {
                            fs.rename(baseDir + file, `${baseDir}cover-${index}`, () => {});
                            hasNameNum++;
                        
                        }
                    }
                })
            }
        }
    })
    ```
### 没完成的
今天时间有点紧，有的部分想做但每完成，这里备注一下,以后有时间做一下
- 搜索功能
- 文章自动生成封面路径
- 站点统计
- 归档功能
- 改一下`code`的显示，现在的感觉很难看

