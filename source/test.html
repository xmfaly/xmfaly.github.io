<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="./atom-one-dark.css">
</head>
<body>

	<pre>
		<code class="js">
			var gulp = require(&#39;gulp&#39;);
  var minifycss = require(&#39;gulp-clean-css&#39;);
  var uglify = require(&#39;gulp-uglify&#39;);
  var htmlmin = require(&#39;gulp-htmlmin&#39;);
  var htmlclean = require(&#39;gulp-htmlclean&#39;);
  var imagemin = require(&#39;gulp-imagemin&#39;);
  var del = require(&#39;del&#39;);
  var runSequence = require(&#39;run-sequence&#39;);
  var Hexo = require(&#39;hexo&#39;);
  // 清除public文件夹
  gulp.task(&#39;clean&#39;, function () {
      return del([&#39;public/**/*&#39;]);
  });
  // generate html with &#39;hexo generate&#39;
  var hexo = new Hexo(process.cwd(), {});
  gulp.task(&#39;generate&#39;, function (cb) {
      hexo.init().then(function () {
          return hexo.call(&#39;generate&#39;, {
              watch: false
          });
      }).then(function () {
          return hexo.exit();
      }).then(function () {
          return cb()
      }).catch(function (err) {
          console.log(err);
          hexo.exit(err);
          return cb(err);
      })
  })
  // 压缩public目录下的所有css
  gulp.task(&#39;minify-css&#39;, function () {
      return gulp.src(&#39;./public/**/*.css&#39;)
          .pipe(minifycss({
              compatibility: &#39;ie8&#39;
          }))
          .pipe(gulp.dest(&#39;./public&#39;));
  });
  // 压缩public目录下的所有html
  gulp.task(&#39;minify-html&#39;, function () {
      return gulp.src(&#39;./public/**/*.html&#39;)
          .pipe(htmlclean())
          .pipe(htmlmin({
              removeComments: true,
              minifyJS: true,
              minifyCSS: true,
              minifyURLs: true,
          }))
          .pipe(gulp.dest(&#39;./public&#39;))
  });
  // 压缩public目录下的所有js
  gulp.task(&#39;minify-js&#39;, function () {
      return gulp.src(&#39;./public/**/*.js&#39;)
          .pipe(uglify())
          .pipe(gulp.dest(&#39;./public&#39;));
  });
  // 压缩public目录下的所有img： 这个采用默认配置
  gulp.task(&#39;minify-img&#39;, function () {
      return gulp.src(&#39;./public/img/**/*.*&#39;)
          .pipe(imagemin())
          .pipe(gulp.dest(&#39;./public/img&#39;))
  })
  // 同上，压缩图片，这里采用了： 最大化压缩效果。
  gulp.task(&#39;minify-img-aggressive&#39;, function () {
      return gulp.src(&#39;./public/img/**/*.*&#39;)
          .pipe(imagemin(
              [imagemin.gifsicle({ &#39;optimizationLevel&#39;: 3 }),
              imagemin.jpegtran({ &#39;progressive&#39;: true }),
              imagemin.optipng({ &#39;optimizationLevel&#39;: 7 }),
              imagemin.svgo()],
              { &#39;verbose&#39;: true }))
          .pipe(gulp.dest(&#39;./public/img&#39;))
  })
  // 用run-sequence并发执行，同时处理html，css，js，img
  gulp.task(&#39;compress&#39;, function (cb) {
      runSequence([&#39;minify-html&#39;, &#39;minify-css&#39;, &#39;minify-js&#39;, &#39;minify-img-aggressive&#39;], cb);
  });
  // 执行顺序： 清除public目录 -&gt; 产生原始博客内容 -&gt; 执行压缩混淆
  gulp.task(&#39;build&#39;, function (cb) {
      runSequence(&#39;clean&#39;, &#39;generate&#39;, &#39;compress&#39;, cb)
  });
  gulp.task(&#39;default&#39;, [&#39;build&#39;])
</code></pre>
</li>
<li><p>封面图床自动重命名,后来加的图片还会填补空位</p>
<pre><code>  const fs = require(&#39;fs&#39;);
  let baseDir = &#39;source/img/cover/&#39;
  let indexArr = [];

  fs.readdir(baseDir, (err, files) =&gt; {

      // 已经命名过的数量
      let hasNameNum = 0;
      // 找到目前最大的index
      files.forEach((file) =&gt; {

          // 以前已经命名过的
          let covered = file.match(/cover-\d+/);
          if (covered) {
              indexArr.push(Number(covered[0].match(/\d+/)[0]));
              ++hasNameNum;
          }
      })

      // 如果存在没有命名的
      if (hasNameNum !== files.length) {
          indexArr.sort((a, b) =&gt; ( a - b ));
          let index = 0;

          let k = 0; // 已经命名数组的下标
          while (files.length &gt; hasNameNum) {
              files.forEach((file) =&gt; {
                  if (!file.startsWith(&#39;cover&#39;) &amp;&amp; !file.endsWith(&#39;.js&#39;)) {
                      index++;
                      if (indexArr[k] &amp;&amp; index &lt; indexArr[k]) {
                          console.log(index);
                          fs.rename(baseDir + file, `${baseDir}cover-${index}`, () =&gt; { });
                          hasNameNum++;
                      } else if (indexArr[k]) {
                          k++;
                      } else {
                          fs.rename(baseDir + file, `${baseDir}cover-${index}`, () =&gt; {});
                          hasNameNum++;

                      }
                  }
              })
          }
      }
  })
		</code>
	</pre>
	

	<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script> -->
	<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>