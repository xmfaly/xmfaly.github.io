<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[使用Service部署Spring Boot]]></title>
      <url>/2017/10/06/%E4%BD%BF%E7%94%A8Service%E9%83%A8%E7%BD%B2Spring%20Boot/</url>
      <content type="html"><![CDATA[<h4 id="手动部署"><a href="#手动部署" class="headerlink" title="手动部署"></a>手动部署</h4><p>Spring Boot 的部署很简单，无论使用maven还是gradle构建成jar包之后，上传到服务器上，运行 <code>java -jar *.jar</code> 即可完成简单的部署。如果想使用外部的配置文件直接在后面加参数就行了  <code>--spring.config.location=application-production.yml</code>  如果想关闭终端还在后台启动的话加上 nohup 就可以了<br><code>nohup java -jar *.jar  --spring.config.location=application-production.yml</code></p>
<h4 id="杀掉进程"><a href="#杀掉进程" class="headerlink" title="杀掉进程"></a>杀掉进程</h4><p>普通情况只要关闭终端或ctrl+c即可结束应用，如果使用nohup部署的话先要找到进程号，然后杀掉进程。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">lsof -i:8080</div><div class="line">COMMAND  PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</div><div class="line">java    2417 root   26u  IPv6 1672621      0t0  TCP *:webcache (LISTEN)</div><div class="line">kill -9 2417</div></pre></td></tr></table></figure></p>
<h4 id="使用service"><a href="#使用service" class="headerlink" title="使用service"></a>使用service</h4><p>如果每一次部署和杀死都要手动的话，频率多了其实也挺麻烦的，可以使用脚本来解决这个问题。<br>在 <code>etc/init.d</code> 先建一个脚本，把这个项目作为service来运行<br>例如 新建<code>etc/init.d/test</code><br>内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line">SERVICE_NAME=test</div><div class="line">HOME=/root/webserver/test</div><div class="line">PATH_TO_JAR=$HOME/*.jar</div><div class="line">PID_PATH_NAME=/tmp/test.pid</div><div class="line"></div><div class="line">LOG=$HOME/production.log</div><div class="line">ERROR_LOG=$HOME/production.err</div><div class="line">CONFIG=$HOME/application-production.yml</div><div class="line">case $1 in</div><div class="line">    start)</div><div class="line">        echo &quot;Starting $SERVICE_NAME ...&quot;</div><div class="line">        if [ ! -f $PID_PATH_NAME ]; then</div><div class="line">            cd $HOME</div><div class="line">            nohup java -jar $PATH_TO_JAR --spring.config.location=application-production.yml &gt; $LOG 2&gt; $ERROR_LOG &amp;</div><div class="line">                        echo $! &gt; $PID_PATH_NAME</div><div class="line">            echo &quot;$SERVICE_NAME started ...&quot;</div><div class="line">        else</div><div class="line">            echo &quot;$SERVICE_NAME is already running ...&quot;</div><div class="line">        fi</div><div class="line">    ;;</div><div class="line">    stop)</div><div class="line">        if [ -f $PID_PATH_NAME ]; then</div><div class="line">            PID=$(cat $PID_PATH_NAME);</div><div class="line">            echo &quot;$SERVICE_NAME stoping ...&quot;</div><div class="line">            kill $PID;</div><div class="line">            echo &quot;$SERVICE_NAME stopped ...&quot;</div><div class="line">            rm $PID_PATH_NAME</div><div class="line">        else</div><div class="line">            echo &quot;$SERVICE_NAME is not running ...&quot;</div><div class="line">        fi</div><div class="line">    ;;</div><div class="line">    restart)</div><div class="line">        if [ -f $PID_PATH_NAME ]; then</div><div class="line">            PID=$(cat $PID_PATH_NAME);</div><div class="line">            echo &quot;$SERVICE_NAME stopping ...&quot;;</div><div class="line">            kill $PID;</div><div class="line">            echo &quot;$SERVICE_NAME stopped ...&quot;;</div><div class="line">            rm $PID_PATH_NAME</div><div class="line">            echo &quot;$SERVICE_NAME starting ...&quot;</div><div class="line">            cd $HOME/current</div><div class="line">            nohup java -jar $PATH_TO_JAR --spring.config.location=application-production.yml &gt; $LOG 2&gt; $ERROR_LOG &amp;</div><div class="line">                        echo $! &gt; $PID_PATH_NAME</div><div class="line">            echo &quot;$SERVICE_NAME started ...&quot;</div><div class="line">        else</div><div class="line">            echo &quot;$SERVICE_NAME is not running ...&quot;</div><div class="line">        fi</div><div class="line">    ;;</div><div class="line">esac</div></pre></td></tr></table></figure></p>
<p>保存脚本<br>赋予脚本可执行权限 <code>sudo chmod +x  etc/init.d/test</code><br>把需要部署的jar包放到脚本中<code>HOME</code>的目录下，然后就可以使用service的方式部署或杀死项目了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo service test start</div><div class="line">sudo service test stop</div><div class="line">sudo service test restart</div></pre></td></tr></table></figure></p>
]]></content>
      
        
        <tags>
            
            <tag> spring </tag>
            
        </tags>
        
    </entry>
    
  
  
    
  
</search>
