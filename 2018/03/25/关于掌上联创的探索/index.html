<!DOCTYPE html><html lang="" class="loading"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><title>追梦</title><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="google" content="notranslate"><meta name="keywords" content="yidreamc,"><meta name="author" content="yidreamc"><link rel="alternative" href="atom.xml" title="追梦" type="application/atom+xml"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><link rel="stylesheet" href="/css/diaspora.css"><link href="/plugins/hljs/atom-one-dark.css" rel="stylesheet"><link rel="stylesheet" href="/styles/css/main.css"></head><body class="loading"><div id="loader"></div><div id="single"><div id="top" style="display:block"><div class="bar" style="width:0"></div><a class="icon-home image-icon" href="javascript:;"></a><h3 class="subtitle">关于掌上联创的探索</h3><div class="social"></div><div class="scrollbar"></div></div><div class="section"><div class="article"><div class="main"><h1 id="title" class="title">关于掌上联创的探索</h1><div class="stuff"> <span>三月 25, 2018</span></div><div class="content markdown"><p>我们学校使用了联创打印系统，应该好多学校都在用，他们提供了一个客户端，我们下载之后在本地打印，之后到打印机刷卡取走打印的东西。<br>这个系统对于以前去学校外面排队打印而言相当方便。<br>我使用这个系统的主要场景就是打印课件，很多时候老师前天把课件发给我们，第二天讲课会用到，但是忘记在电脑上打印了就贼尴尬，因为联创只提供pc版的客户端，这个时候在教室的我就显得很无助了。为此有一阵还特地开着电脑，方便随时可以用teamviewer进行控制打印。<br>刚开始的时候我还想他们为什么不提供一个手机客户端，后来我了解到打印机只负责打印，他们的客户端负责传输，而文件的格式解析什么的都在本地进行，也就是假如我想打印一个word文件，我电脑上必须有可以识别word的软件，否则我就不能打印。也就是说，如果做一个手机客户端，在现有的环境下，几乎是不可能的，因为主流的手机可以解析word，pdf的这些软件都不提供打印的接口。让联创自己做，当我没说吧。<br>我就想我能不能在服务器上做一个中转，我的手机把文件传到服务器上，然后服务器上装了联创的客户端和各种能够解析pdf，word这些的软件，在服务器上把我想打印的文件送到联创的服务器上。<br>想想还觉得蛮简单的，但是实际操作的时候遇到了一系列的问题。</p><h3 id="服务器环境"><a href="#服务器环境" class="headerlink" title="服务器环境"></a>服务器环境</h3><p>因为联创只提供windows客户端为了简便起见我也选择了windows的服务器。</p><h3 id="内网问题"><a href="#内网问题" class="headerlink" title="内网问题"></a>内网问题</h3><p>我是用的时腾讯云的服务器，但是学校联创客户端只有校园网才可以连接，我们学校也提供vpn，有两种方式一种是客户端，一种是直接设置，直接设置那种在平常的pc机上很简单，但是如果是服务器上就相当麻烦，正好是windows服务器，我就直接下载了客户端安装上。登陆之后发现再也连不上服务器了，因为vpn改变了地址。问了大佬们如何解决这个问题，有人说可以设置解决这个，也有人说可以搞两台服务器，一台做反向代理转发，一台开vpn。我觉得这两个办法都行，但我没有采用，我用的是sock5 + Proxifier解决这个问题的。</p><h3 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h3><p>因为打印的文件可能有多种格式。我的服务器内存有限所以我肯定不能把各种软件都装一遍。最后折中一下我选择装 Sumatra PDF + Liboffice 。pdf软件负责解析文件和office软件负责把所有其他格式的文件转换成pdf。</p><h3 id="自动执行"><a href="#自动执行" class="headerlink" title="自动执行"></a>自动执行</h3><p>因为平时用的都是java，一开始想找一个java的可以控制窗口程序的库，但最后还是放弃了，果断转为python，我才用一个非常流行的窗口程序测试框架pywinauto来控制打印机程序和pdf解析软件。之所以不用命令行直接控制打印机，我感觉是因为联创当时写的时候的有个bug把。把任务放到队列中一直不打印，所以只能模拟人工操作了。也可能是我对windows的打印任务不了解导致的。</p><h3 id="web框架"><a href="#web框架" class="headerlink" title="web框架"></a>web框架</h3><p>这里先说一下为啥不用微信小程序，微信小程序是提供了文件上传功能的，但是不提供文件选择的api，换句话说，我可以上传，但是鬼知道你要上传的文件在哪个文件夹里，叫什么名字。所以没办法只能选择html5了，后台方面因为主要逻辑都是python，所以直接整了个python的web框架flask，话说python的东西就是简单方便，这个框架我看了还不到10分钟吧就能上手写东西了。</p><h3 id="统一身份认证"><a href="#统一身份认证" class="headerlink" title="统一身份认证"></a>统一身份认证</h3><p>联创使用了我们学校的统一身份认证，但是感觉他的逻辑有点问题，先解析文件，然后认证，然后上传打印，如果我也模拟他这样的操作的话，本身我的服务器带宽低资源少，费了半天时间传到服务器上，然后又是半天解析文件，然后反回来一个用户名密码错误。<br>所以我放弃了联创自带的认证，在传文件之前用requests向统一身份认证接口post数据，认证成功继续，失败直接返回结果。</p><h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><p>当然还有一些解决不了的或者不能解决的问题。上面也提到了一方面是网速，一方面是服务器资源。当然还有我的调度算法，falsk的单线程。这些都是问题。不过没太有时间去优化了。暂时可以用就行了吧。</p><p>最后福利时间，放出地址吧。这个项目我不是很想开源，而且由于服务器资源有限，肯定是不能对所有人开放的。希望看到地址的人且行且珍惜，不要乱宣传。<a href="http://115.159.153.43:5000/login" target="_blank" rel="noopener">http://115.159.153.43:5000/login</a></p><!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]--></div><div id="gitalk-container" class="comment link" data-ae="true" data-ci="b13f1c99b04e2cb032ba" data-cs="8b5cec5e81b3ab9ff1b533046e66f15650d0e98c" data-r="yidreamc.github.io" data-o="yidreamc" data-a="yidreamc" data-d="false">查看评论</div></div><div class="side"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#服务器环境"><span class="toc-number">1.</span> <span class="toc-text">服务器环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内网问题"><span class="toc-number">2.</span> <span class="toc-text">内网问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件格式"><span class="toc-number">3.</span> <span class="toc-text">文件格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自动执行"><span class="toc-number">4.</span> <span class="toc-text">自动执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web框架"><span class="toc-number">5.</span> <span class="toc-text">web框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#统一身份认证"><span class="toc-number">6.</span> <span class="toc-text">统一身份认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他问题"><span class="toc-number">7.</span> <span class="toc-text">其他问题</span></a></li></ol></div></div></div></div></body><script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script><script src="/js/plugin.js"></script><script src="/js/diaspora.js"></script><link rel="stylesheet" href="/photoswipe/photoswipe.css"><link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css"><script src="/photoswipe/photoswipe.min.js"></script><script src="/photoswipe/photoswipe-ui-default.min.js"></script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad()</script></html>