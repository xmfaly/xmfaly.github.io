<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  
  <title>关于掌上联创的探索</title>
  <meta name="author" content="yidreamc">
  <meta name="description" content="我们学校使用了联创打印系统，应该好多学校都在用，他们提供了一个客户端，我们下载之后在本地打印，之后到打印机刷卡取走打印的东西。这个系统对于以前去学校外面排队打印而言相当方便。我使用这个系统的主要场景就是打印课件，很多时候老师前天把课件发给我们，第二天讲课会用到，但是忘记在电脑上打印了就贼尴尬，因为联">
  
  
  <meta property="og:title" content="关于掌上联创的探索"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="追梦"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="追梦" type="application/atom+xml">
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="behind">
      <a href="/" class="back black-color">
        <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M2 30 L30 2 M30 30 L2 2"></path>
        </svg>
      </a>
      <div class="description">
        &nbsp;
      </div>
    </div>
    <div class="container">
      

  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        关于掌上联创的探索
    </h1>
  


    </div>
    <div class="meta center">
      
<time datetime="2018-03-25T03:51:00.000Z">
<svg class="i-calendar" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2018-03-25
</time>







    </div>
    <hr>
    <div class="picture-container">
      
    </div>
    <p>我们学校使用了联创打印系统，应该好多学校都在用，他们提供了一个客户端，我们下载之后在本地打印，之后到打印机刷卡取走打印的东西。<br>这个系统对于以前去学校外面排队打印而言相当方便。<br>我使用这个系统的主要场景就是打印课件，很多时候老师前天把课件发给我们，第二天讲课会用到，但是忘记在电脑上打印了就贼尴尬，因为联创只提供pc版的客户端，这个时候在教室的我就显得很无助了。为此有一阵还特地开着电脑，方便随时可以用teamviewer进行控制打印。<br>刚开始的时候我还想他们为什么不提供一个手机客户端，后来我了解到打印机只负责打印，他们的客户端负责传输，而文件的格式解析什么的都在本地进行，也就是假如我想打印一个word文件，我电脑上必须有可以识别word的软件，否则我就不能打印。也就是说，如果做一个手机客户端，在现有的环境下，几乎是不可能的，因为主流的手机可以解析word，pdf的这些软件都不提供打印的接口。让联创自己做，当我没说吧。<br>我就想我能不能在服务器上做一个中转，我的手机把文件传到服务器上，然后服务器上装了联创的客户端和各种能够解析pdf，word这些的软件，在服务器上把我想打印的文件送到联创的服务器上。<br>想想还觉得蛮简单的，但是实际操作的时候遇到了一系列的问题。</p>
<h3 id="服务器环境"><a href="#服务器环境" class="headerlink" title="服务器环境"></a>服务器环境</h3><p>因为联创只提供windows客户端为了简便起见我也选择了windows的服务器。</p>
<h3 id="内网问题"><a href="#内网问题" class="headerlink" title="内网问题"></a>内网问题</h3><p>我是用的时腾讯云的服务器，但是学校联创客户端只有校园网才可以连接，我们学校也提供vpn，有两种方式一种是客户端，一种是直接设置，直接设置那种在平常的pc机上很简单，但是如果是服务器上就相当麻烦，正好是windows服务器，我就直接下载了客户端安装上。登陆之后发现再也连不上服务器了，因为vpn改变了地址。问了大佬们如何解决这个问题，有人说可以设置解决这个，也有人说可以搞两台服务器，一台做反向代理转发，一台开vpn。我觉得这两个办法都行，但我没有采用，我用的是sock5 + Proxifier解决这个问题的。</p>
<h3 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h3><p>因为打印的文件可能有多种格式。我的服务器内存有限所以我肯定不能把各种软件都装一遍。最后折中一下我选择装 Sumatra PDF + Liboffice 。pdf软件负责解析文件和office软件负责把所有其他格式的文件转换成pdf。</p>
<h3 id="自动执行"><a href="#自动执行" class="headerlink" title="自动执行"></a>自动执行</h3><p>因为平时用的都是java，一开始想找一个java的可以控制窗口程序的库，但最后还是放弃了，果断转为python，我才用一个非常流行的窗口程序测试框架pywinauto来控制打印机程序和pdf解析软件。之所以不用命令行直接控制打印机，我感觉是因为联创当时写的时候的有个bug把。把任务放到队列中一直不打印，所以只能模拟人工操作了。也可能是我对windows的打印任务不了解导致的。</p>
<h3 id="web框架"><a href="#web框架" class="headerlink" title="web框架"></a>web框架</h3><p>这里先说一下为啥不用微信小程序，微信小程序是提供了文件上传功能的，但是不提供文件选择的api，换句话说，我可以上传，但是鬼知道你要上传的文件在哪个文件夹里，叫什么名字。所以没办法只能选择html5了，后台方面因为主要逻辑都是python，所以直接整了个python的web框架flask，话说python的东西就是简单方便，这个框架我看了还不到10分钟吧就能上手写东西了。</p>
<h3 id="统一身份认证"><a href="#统一身份认证" class="headerlink" title="统一身份认证"></a>统一身份认证</h3><p>联创使用了我们学校的统一身份认证，但是感觉他的逻辑有点问题，先解析文件，然后认证，然后上传打印，如果我也模拟他这样的操作的话，本身我的服务器带宽低资源少，费了半天时间传到服务器上，然后又是半天解析文件，然后反回来一个用户名密码错误。<br>所以我放弃了联创自带的认证，在传文件之前用requests向统一身份认证接口post数据，认证成功继续，失败直接返回结果。</p>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><p>当然还有一些解决不了的或者不能解决的问题。上面也提到了一方面是网速，一方面是服务器资源。当然还有我的调度算法，falsk的单线程。这些都是问题。不过没太有时间去优化了。暂时可以用就行了吧。</p>
<p>最后福利时间，放出地址吧。这个项目我不是很想开源，而且由于服务器资源有限，肯定是不能对所有人开放的。希望看到地址的人且行且珍惜，不要乱宣传。<a href="http://115.159.153.43:5000/login" target="_blank" rel="noopener">http://115.159.153.43:5000/login</a></p>


  </article>
  </script>
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <div class="busuanzi center">
    page PV:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    site PV:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    site UV:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>




    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>

<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
